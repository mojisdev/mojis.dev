---
import PageLayout from "../../../../../layouts/page-layout.astro";
import { queryVersions, queryCategories } from "../../../../../lib/query-builder";

export async function getStaticPaths() {
  // This demonstrates a more complex path generation case
  // We need to handle the triple-nested paths: [version]/[category]/[subcategory]

  const versions = await queryVersions()
    .where('draft', '=', false) // Only non-draft versions
    .all();

  const paths = [];

  for (const version of versions) {
    const categories = await queryCategories(version.emoji_version!)
      .all();

    for (const category of categories) {
      // For each subcategory in the category, create a path
      for (const subcategory of category.subgroups) {
        paths.push({
          params: {
            version: version.emoji_version,
            category: category.slug,
            subcategory: subcategory,
          },
          props: {
            version: version.emoji_version,
            category,
            subcategory,
          },
        });
      }
    }
  }

  return paths;
}

const { version, category, subcategory } = Astro.props;
---

<PageLayout>
  <h1>Version: {version}</h1>
  <h2>Category: {category.name}</h2>
  <h3>Subcategory: {subcategory}</h3>

  <div class="actions">
    <a href={`/${version}/categories/${category.slug}`}>‚Üê Back to Category</a>
  </div>
</PageLayout>
