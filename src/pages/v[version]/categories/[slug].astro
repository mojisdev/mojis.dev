---
import PageLayout from '../../../layouts/page-layout.astro';

export async function getStaticPaths() {
  const res = await fetch("https://raw.githubusercontent.com/mojisdev/emoji-data/refs/heads/main/emojis.lock");

  if (!res.ok) {
    throw new Error("failed to fetch emoji versions");
  }

  const json = await res.json()

  const versions = json.versions;

  const paths = [];

  for (const version of versions) {
    const categoriesRes = await fetch("https://raw.githubusercontent.com/mojisdev/emoji-data/refs/heads/main/unicode/" + version + "/categories.json")

    if (!categoriesRes.ok) {
      throw new Error("failed to fetch categories for version " + version);
    }

    const categoriesJson = await categoriesRes.json();

    for (const category of categoriesJson) {
      paths.push({
        params: { slug: category.slug, version }
      });
    }
  }

  return paths;
}

const { version, slug } = Astro.params;
---

<PageLayout>
  <h1>Version: {version}</h1>
  <h2>Category: {slug}</h2>
</PageLayout>
