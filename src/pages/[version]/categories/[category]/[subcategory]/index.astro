---
import PageLayout from "../../../../../layouts/page-layout.astro";
import { queryCollection, queryCategories } from "../../../../../lib/query-builder";

export async function getStaticPaths() {
  // Get all versions
  const versions = await queryCollection('versions')
    .select('emoji_version')
    .where('draft', '=', false) // Filter out draft versions
    .all();

  const paths = [];

  // For each version, get categories
  for (const version of versions) {
    const categories = await queryCategories(version.emoji_version!)
      .all();

    // For each category, build paths for its subcategories
    for (const category of categories) {
      for (const subcategory of category.subgroups) {
        paths.push({
          params: {
            version: version.emoji_version,
            category: category.slug,
            subcategory: subcategory,
          },
          props: {
            version: version.emoji_version,
            category,
            subcategory,
          },
        });
      }
    }
  }

  return paths;
}

const { version, category, subcategory } = Astro.props;
---

<PageLayout>
  <h1>Version: {version}</h1>
  <h2>Category: {category.name}</h2>
  <h3>Subcategory: {subcategory}</h3>

  <p>This demonstrates the advanced query builder usage.</p>

  <div class="actions">
    <a href={`/${version}/categories/${category.slug}`}>‚Üê Back to Category</a>
  </div>
</PageLayout>
